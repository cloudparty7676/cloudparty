<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è‡ªåŠ©å‹å ±å–®å°å·¥å…·</title>
  <style>
    :root{
      --bg:#f6fbff;
      --card:#ffffff;
      --text:#0b1220;
      --muted:#4b5a77;
      --line:rgba(26,60,120,.12);
      --primary:#2f9bff;
      --primary2:#84ddff;
      --good:#4ff0c8;
      --warn:#ffd36b;
      --bad:#ff6b8b;
      --shadow: 0 18px 60px rgba(10,40,90,.12);
      --shadow2: 0 10px 28px rgba(10,40,90,.10);
      --radius: 18px;
      --radius2: 26px;
      --max: 1120px;
      --table-w: 960px;
    }
    * { box-sizing: border-box; }
    body{
      margin:0;
      font-size:14px;
      color:var(--text);
      background:
        radial-gradient(1200px 760px at 20% -10%, rgba(47,155,255,.22), transparent 55%),
        radial-gradient(900px 560px at 90% 10%, rgba(132,221,255,.22), transparent 60%),
        radial-gradient(900px 560px at 70% 90%, rgba(79,240,200,.14), transparent 60%),
        var(--bg);
      font-family: MPLUSRounded1c, NotoSansTC, helvetica, arial, sans-serif;
      line-height:1.43;
    }
    @media print {
      body { background: #fff; }
      .no-print { display: none !important; }
    }
    @font-face {
      font-family: NotoSansTC;
      src: url("https://swap-fonts.s3.ap-northeast-1.amazonaws.com/NotoSansTC-Regular.otf") format("opentype");
      font-weight: 400;
      font-display: swap;
    }
    @font-face {
      font-family: NotoSansTC;
      src: url("https://swap-fonts.s3.ap-northeast-1.amazonaws.com/NotoSansTC-Bold.otf") format("opentype");
      font-weight: 700;
      font-display: swap;
    }
    @font-face {
      font-family: NotoSansTC;
      src: url("https://swap-fonts.s3.ap-northeast-1.amazonaws.com/NotoSansTC-Black.otf") format("opentype");
      font-weight: 900;
      font-display: swap;
    }
    @font-face {
      font-family: MPLUSRounded1c;
      src: url("https://swap-fonts.s3.ap-northeast-1.amazonaws.com/MPLUSRounded1c-Regular.ttf") format("truetype");
      unicode-range: U+00-024F;
      font-weight: 400;
      font-display: swap;
    }
    @font-face {
      font-family: MPLUSRounded1c;
      src: url("https://swap-fonts.s3.ap-northeast-1.amazonaws.com/MPLUSRounded1c-Bold.ttf") format("truetype");
      unicode-range: U+00-024F;
      font-weight: 700;
      font-display: swap;
    }
    @font-face {
      font-family: MPLUSRounded1c;
      src: url("https://swap-fonts.s3.ap-northeast-1.amazonaws.com/MPLUSRounded1c-Black.ttf") format("truetype");
      unicode-range: U+00-024F;
      font-weight: 900;
      font-display: swap;
    }

    .page{max-width:var(--max); margin:0 auto; padding:24px 16px 80px}
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
    }
    .logo{
      font-weight:900;
      font-size:18px;
      letter-spacing:.5px;
      text-decoration:none;
      color:#111;
    }
    h1 {
      font-size: 1.5rem;
      margin: 0;
      color: rgba(33, 33, 33, 1);
      font-style: italic;
    }
    .updated {
      color: rgba(33, 33, 33, 0.8);
    }
    .intro {
      font-size: 1rem;
      color: rgba(33, 33, 33, 1);
      margin-top: 8px;
    }
    .ps {
      font-style: italic;
      color: rgba(55, 55, 55, 0.9);
      margin: 8px 0 16px;
    }

    .sheet-wrap{position:relative}
    .tool-buttons {
      position: absolute;
      top: 0;
      right: -30px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .tool-buttons button {
      width: 31px;
      font-size: 15px;
      cursor: pointer;
    }

    table{
      width:var(--table-w);
      max-width:var(--table-w);
      min-width:var(--table-w);
      word-break:break-all;
      border-collapse:collapse;
      white-space:normal;
      background:rgba(255,255,255,.86);
      border:1px solid var(--line);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    table, td{border:1px solid var(--line)}
    td{background:rgba(255,255,255,.86)}
    td {
      padding: 12px;
      vertical-align: middle;
    }
    th.table-head {
      border: none;
      height: 0.1px;
      padding: 0;
    }

    .row-title {
      display: flex;
      align-items: center;
      height: 100%;
      width: 100%;
    }
    .inline {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .muted {
      color: var(--muted);
    }

    input[type="text"],
    input[type="number"],
    textarea,
    select{
      width:100%;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      font-size:14px;
      font-family:inherit;
      background:rgba(255,255,255,.88);
      box-shadow:var(--shadow2);
    }
    input[type="number"] { text-align: right; }
    textarea { resize: vertical; min-height: 88px; }

    .amount-row {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .calc {
      font-weight: 700;
    }

    .image-box{
      position:relative;
      border:2px dashed rgba(26,60,120,.18);
      width:390px;
      height:195px;
      display:flex;
      justify-content:center;
      align-items:center;
      border-radius:16px;
      background:rgba(255,255,255,.9);
      box-shadow:var(--shadow2);
    }
    .image-box img {
      display: block;
      max-width: 100%;
      max-height: 100%;
    }
    .image-box input[type="file"] {
      position: absolute;
      width: 100%;
      height: 100%;
      cursor: pointer;
      opacity: 0;
      z-index: 3;
    }
    .image-hint {
      text-align: center;
      font-size: 12px;
      color: #333;
    }

    .actions{margin-top:16px; display:flex; gap:12px; flex-wrap:wrap}
    .actions button{
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:12px 16px; border-radius:14px;
      border:1px solid rgba(47,155,255,.28);
      background:linear-gradient(180deg, rgba(47,155,255,.18), rgba(47,155,255,.08));
      box-shadow:0 12px 30px rgba(47,155,255,.12);
      font-weight:800; cursor:pointer; transition:.15s ease;
    }
    .actions button:hover{transform:translateY(-1px); box-shadow:0 18px 38px rgba(47,155,255,.16)}
    .actions button.primary{
      border:0;
      background:linear-gradient(135deg, var(--primary), var(--primary2));
      color:#fff;
      box-shadow:0 18px 50px rgba(47,155,255,.28);
    }

    .notice {
      margin-top: 18px;
      line-height: 1.6;
    }

    .email-block{
      margin-top:36px;
      padding-top:24px;
      border-top:1px solid var(--line);
    }
    .email-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .email-row input { flex: 1; min-width: 220px; }

    .footer{
      border-top:1px solid var(--line);
      padding:16px 0;
      margin-top:40px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    body.pdf-mode{
      background:#ffffff;
    }
    body.pdf-mode table{
      background:#ffffff;
      border-radius:0;
      box-shadow:none;
      border:1px solid #000000;
    }
    body.pdf-mode td{
      background:#ffffff;
      border:1px solid #000000;
    }
    body.pdf-mode input[type="text"],
    body.pdf-mode input[type="number"],
    body.pdf-mode textarea,
    body.pdf-mode select{
      background:#ffffff;
      box-shadow:none;
      border:1px solid #000000;
    }
    body.pdf-mode .image-box{
      box-shadow:none;
      background:#ffffff;
      border:2px dashed #000000;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="page">
    
    <div class="sheet-wrap" id="pdf-content">
      <div class="tool-buttons no-print">
        <button id="btn-sample" title="åŒ¯å…¥ç¯„æœ¬">ğŸ‘†</button>
        <button id="btn-clear" title="æ¸…é™¤é‡å¡«">ğŸ—‘ï¸</button>
      </div>

      <table id="labor-reward-sheet">
        <tr>
          <th class="table-head" style="width:100px"></th>
          <th class="table-head" style="width:0"></th>
          <th class="table-head" style="width:0"></th>
        </tr>
        <tr>
          <td colspan="3">
            <div class="inline" style="justify-content: space-between; align-items: flex-end;">
              <div style="flex:1;">
                <div style="font-size: 16px; font-weight: 400;">é›²æ´¾å° å‹å‹™å ±é…¬å–®</div>
                <div class="inline" style="margin-top: 6px; gap: 16px;">
                  <label style="flex:1;">
                    å…¬å¸åç¨±ï¼š
                    <input type="text" id="company-name" placeholder="å…¬å¸åç¨±" />
                  </label>
                  <label style="flex:1;">
                    å…¬å¸è¯çµ¡æ–¹å¼ï¼š
                    <input type="text" id="company-contact" placeholder="ä¿¡ç®±/æ‰‹æ©Ÿ" />
                  </label>
                </div>
              </div>
              <div style="min-width: 160px; text-align: right;">è£½è¡¨æ—¥æœŸï¼š<span id="date"></span></div>
            </div>
          </td>
        </tr>
        <tr>
          <td rowspan="4"><div class="row-title">é ˜æ¬¾äººåŸºæœ¬è³‡æ–™</div></td>
          <td colspan="2">
            <div class="inline">å§“åï¼š<input type="text" id="payee-name" placeholder="é ˜æ¬¾äººå§“å" /></div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="inline">èº«åˆ†è­‰å­—è™Ÿ<br />(å¤–åœ‹ç±è«‹å¡«å±…ç•™è­‰è™Ÿ)ï¼š<input type="text" id="id-number" /></div>
          </td>
          <td>
            <div class="inline">è¯çµ¡æ–¹å¼ï¼š<input type="text" id="contact" placeholder="ä¿¡ç®±/æ‰‹æ©Ÿ" /></div>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <div class="inline">æˆ¶ç±åœ°å€ï¼š<input type="text" id="address" placeholder="åœ°å€" /></div>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <div class="inline" style="gap: 12px;">
              <div>åœ‹ç±ï¼š</div>
              <label><input type="radio" name="nationality" value="domestic" checked /> æœ¬åœ‹ç±</label>
              <label><input type="radio" name="nationality" value="foreignAbove183" /> å¤–åœ‹ç±(æœ‰å±…ç•™è­‰ï¼Œåœ¨å°æ»¿ 183 å¤©)</label>
              <label><input type="radio" name="nationality" value="foreignBelow183" /> å¤–åœ‹ç±(æœ‰å±…ç•™è­‰ï¼Œåœ¨å°æœªæ»¿ 183 å¤©)</label>
            </div>
          </td>
        </tr>
        <tr>
          <td><div class="row-title">å‹å‹™å…§å®¹</div></td>
          <td colspan="2"><textarea id="labor-content" placeholder="å‹å‹™å…§å®¹"></textarea></td>
        </tr>
        <tr>
          <td><div class="row-title">æ‰€å¾—é¡åˆ¥</div></td>
          <td colspan="2">
            <div class="inline" style="gap: 12px;">
              <select id="income-type" style="max-width: 300px;">
                <option value="">è«‹é¸æ“‡æ‰€å¾—é¡åˆ¥</option>
                <option value="9A">9A åŸ·è¡Œæ¥­å‹™æ‰€å¾—</option>
                <option value="9B">9B ç¨¿è²»</option>
                <option value="50">50 è–ªè³‡</option>
              </select>
              <select id="business-type" style="max-width: 300px; display: none;"></select>
            </div>
          </td>
        </tr>
        <tr>
          <td rowspan="4"><div class="row-title">é‡‘é¡</div></td>
          <td colspan="2">
            <div class="amount-row">
              æ‡‰ä»˜ç¸½é¡ï¼š
              <input type="number" id="total-amount" min="0" placeholder="0" style="max-width: 200px;" />
              å…ƒ
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <div class="amount-row">
              ï¼ ä»£æ‰£ç¹³æ‰€å¾—ç¨… <span id="tax-desc" class="muted"></span>ï¼š
              <span class="calc" id="tax">N/A</span>
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <div class="amount-row" style="justify-content: space-between; width: 100%;">
              <div class="amount-row">
                ï¼ äºŒä»£å¥ä¿è£œå……ä¿è²» <span id="health-desc" class="muted"></span>ï¼š
                <span class="calc" id="health">N/A</span>
              </div>
              <label class="no-print" style="display: flex; align-items: center; gap: 6px;">
                <input type="checkbox" id="union-insured" /> é ˜æ¬¾äººæœ‰æŠ•ä¿å·¥æœƒ
              </label>
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <div class="amount-row">
              ï¼ æ‡‰ä»˜æ·¨é¡ï¼š
              <span class="calc" id="net">N/A</span>
            </div>
          </td>
        </tr>
        <tr>
          <td><div class="row-title">é ˜æ¬¾äººèº«åˆ†è­‰ä»¶</div></td>
          <td>
            <div>æ­£é¢</div>
            <div class="image-box">
              <div class="image-hint">é»æ­¤æ’å…¥åœ–ç‰‡<br />å¯¬:é•· = 2:1 çš„åœ–ç‰‡æ¯”ä¾‹æœ€ä½³</div>
              <input type="file" id="id-front" accept="image/jpeg, image/png" />
              <img id="id-front-preview" alt="èº«åˆ†è­‰æ­£é¢" style="display:none;" />
            </div>
          </td>
          <td>
            <div>åé¢</div>
            <div class="image-box">
              <div class="image-hint">é»æ­¤æ’å…¥åœ–ç‰‡<br />å¯¬:é•· = 2:1 çš„åœ–ç‰‡æ¯”ä¾‹æœ€ä½³</div>
              <input type="file" id="id-back" accept="image/jpeg, image/png" />
              <img id="id-back-preview" alt="èº«åˆ†è­‰åé¢" style="display:none;" />
            </div>
          </td>
        </tr>
        <tr>
          <td><div class="row-title">ä»˜æ¬¾æ–¹å¼</div></td>
          <td colspan="2">
            <textarea id="payment-method" placeholder="æ”¯æ´ï¼šåŒ¯æ¬¾ / æ”¯ç¥¨ / ç¾é‡‘"></textarea>
          </td>
        </tr>
        <tr>
          <td><div class="row-title">ç°½å</div></td>
          <td>
            <div>é ˜æ¬¾äºº</div>
            <div class="image-box">
              <div class="image-hint">é»æ­¤æ’å…¥åœ–ç‰‡</div>
              <input type="file" id="signature-payee" accept="image/jpeg, image/png" />
              <img id="signature-payee-preview" alt="é ˜æ¬¾äººç°½å" style="display:none;" />
            </div>
          </td>
          <td>
            <div>ç¶“è¾¦äºº</div>
            <div class="image-box">
              <div class="image-hint">é»æ­¤æ’å…¥åœ–ç‰‡</div>
              <input type="file" id="signature-company" accept="image/jpeg, image/png" />
              <img id="signature-company-preview" alt="å…¬å¸ä»£è¡¨ç°½å" style="display:none;" />
            </div>
          </td>
        </tr>
      </table>
    </div>

    <div class="actions no-print">
      <button id="btn-download" class="primary">ä¸‹è¼‰å‹å‹™å ±é…¬å–®</button>
    </div>
  </div>

  <script>
    const dateEl = document.getElementById('date');
    dateEl.textContent = new Date().toISOString().split('T')[0];

    const incomeTypeEl = document.getElementById('income-type');
    const businessTypeEl = document.getElementById('business-type');
    const unionInsuredEl = document.getElementById('union-insured');
    const totalAmountEl = document.getElementById('total-amount');
    const taxEl = document.getElementById('tax');
    const healthEl = document.getElementById('health');
    const netEl = document.getElementById('net');
    const taxDescEl = document.getElementById('tax-desc');
    const healthDescEl = document.getElementById('health-desc');

    function getNationality() {
      const checked = document.querySelector('input[name="nationality"]:checked');
      return checked ? checked.value : 'domestic';
    }

    const businessOptions9A = [
      { value: '', label: 'åŸ·è¡Œæ¥­å‹™é¡åˆ¥ (é¸å¡«)' },
      { value: '10', label: '10 å¾‹å¸«' },
      { value: '11', label: '11 æœƒè¨ˆå¸«' },
      { value: '12', label: '12 ç²¾ç®—å¸«' },
      { value: '13', label: '13 åœ°æ”¿å£«' },
      { value: '14', label: '14 è¨˜å¸³å£«' },
      { value: '15', label: '15 ä»²è£äºº' },
      { value: '16', label: '16 æ°‘é–“å…¬è­‰äºº' },
      { value: '17', label: '17 ä¸å‹•ç”¢ä¼°åƒ¹å¸«' },
      { value: '18', label: '18 å—å§”è¨—ä»£è¾¦åœ‹æœ‰éå…¬ç”¨ä¸å‹•ç”¢ä¹‹æ‰¿ç§Ÿã€çºŒç§Ÿã€éæˆ¶åŠç¹¼æ‰¿ç­‰ç”³è«‹è€…' },
      { value: '19', label: '19 è¨˜å¸³åŠå ±ç¨…ä»£ç†äºº' },
      { value: '20', label: '20 æŠ€å¸«' },
      { value: '21', label: '21 å»ºç¯‰å¸«' },
      { value: '22', label: '22 å…¬å…±å®‰æª¢äººå“¡' },
      { value: '23', label: '23 ç¨‹å¼è¨­è¨ˆå¸«' },
      { value: '24', label: '24 å°ˆåˆ©ä»£ç†äºº' },
      { value: '25', label: '25 å°ˆåˆ©å¸«' },
      { value: '26', label: '26 å•†æ¨™ä»£ç†äºº' },
      { value: '27', label: '27 è·èƒ½æ²»ç™‚å¸«' },
      { value: '28', label: '28 ç‰©ç†æ²»ç™‚å¸«' },
      { value: '29', label: '29 ç¾è¡“å·¥è—å®¶' },
      { value: '30', label: '30 å…§ç§‘é†«å¸«' },
      { value: '31', label: '31 å¤–ç§‘é†«å¸«' },
      { value: '32', label: '32 å©¦ç”¢ç§‘é†«å¸«' },
      { value: '33', label: '33 å°å…’ç§‘é†«å¸«' },
      { value: '34', label: '34 è€³é¼»å–‰ç§‘é†«å¸«' },
      { value: '35', label: '35 çœ¼ç§‘é†«å¸«' },
      { value: '36', label: '36 ç‰™ç§‘é†«å¸«' },
      { value: '37', label: '37 ä¸­é†«å¸«' },
      { value: '38', label: '38 éª¨ç§‘é†«å¸«' },
      { value: '39', label: '39 å…¶ä»–ç§‘åˆ¥é†«å¸«' },
      { value: '40', label: '40 åŠ©ç”¢å¸«(å£«)' },
      { value: '41', label: '41 è—¥å¸«' },
      { value: '42', label: '42 ç‡Ÿé¤Šå¸«' },
      { value: '43', label: '43 å¿ƒç†å¸«' },
      { value: '44', label: '44 èªè¨€æ²»ç™‚å¸«' },
      { value: '45', label: '45 ç‰™é«”æŠ€è¡“å¸«(ç”Ÿ)' },
      { value: '46', label: '46 é†«äº‹æª¢é©—å¸«(ç”Ÿ)' },
      { value: '50', label: '50 è‘—ä½œäºº' },
      { value: '60', label: '60 è¡¨æ¼”äºº' },
      { value: '70', label: '70 ç¶“ç´€äºº' },
      { value: '71', label: '71 ä¿éšªç¶“ç´€äºº' },
      { value: '73', label: '73 å…¬ç›Šå½©åˆ¸ç¶“éŠ·å•†' },
      { value: '76', label: '76 ä¸€èˆ¬ç¶“ç´€äºº' },
      { value: '80', label: '80 å¼•æ°´äºº' },
      { value: '90', label: '90 å…¶ä»–' }
    ];

    const businessOptions9B = [
      { value: '', label: 'ç¨¿è²»é¡åˆ¥ (é¸å¡«)' },
      { value: '99', label: '99 è‡ªè¡Œå‡ºç‰ˆ' },
      { value: '98', label: '98 éè‡ªè¡Œå‡ºç‰ˆ' }
    ];

    function renderBusinessOptions(options) {
      businessTypeEl.innerHTML = '';
      options.forEach((opt) => {
        const optionEl = document.createElement('option');
        optionEl.value = opt.value;
        optionEl.textContent = opt.label;
        businessTypeEl.appendChild(optionEl);
      });
    }

    function updateBusinessType() {
      const type = incomeTypeEl.value;
      const show = type === '9A' || type === '9B';
      businessTypeEl.style.display = show ? 'block' : 'none';
      if (!show) {
        businessTypeEl.innerHTML = '';
        return;
      }
      if (type === '9B') {
        renderBusinessOptions(businessOptions9B);
      } else {
        renderBusinessOptions(businessOptions9A);
      }
    }

    function calcFees() {
      const total = Number(totalAmountEl.value || 0);
      const incomeType = incomeTypeEl.value;
      const nationality = getNationality();
      const unionInsured = unionInsuredEl.checked;

      let tax = 'N/A';
      let health = 'N/A';
      let net = 'N/A';
      let taxDesc = '';
      let healthDesc = '';

      if (total > 0 && incomeType) {
        let taxVal = 0;
        let healthVal = 0;

        if (nationality === 'domestic' || nationality === 'foreignAbove183') {
          if (incomeType === '9A' || incomeType === '9B') {
            taxVal = total >= 20010 ? Math.floor(total * 0.1) : 0;
            healthVal = total >= 20000 ? Math.round(total * 0.0211) : 0;
            taxDesc = total >= 20010 ? 'ï¼ˆé” 20010 å…ƒï¼Œä»£æ‰£ç¹³ 10%ï¼‰' : '';
            healthDesc = total >= 20000 ? 'ï¼ˆé” 20000 å…ƒï¼Œä»£æ‰£ç¹³ 2.11%ï¼‰' : '';
          } else if (incomeType === '50') {
            taxVal = total >= 90501 ? Math.floor(total * 0.05) : 0;
            healthVal = total >= 29500 ? Math.round(total * 0.0211) : 0;
            taxDesc = total >= 90501 ? 'ï¼ˆé” 90501 å…ƒï¼Œä»£æ‰£ç¹³ 5%ï¼‰' : '';
            healthDesc = total >= 29500 ? 'ï¼ˆé” 29500 å…ƒï¼Œä»£æ‰£ç¹³ 2.11%ï¼‰' : '';
          }
        } else if (nationality === 'foreignBelow183') {
          if (incomeType === '9A' || incomeType === '9B') {
            taxVal = (incomeType === '9B' && total <= 5000) ? 0 : Math.floor(total * 0.2);
            healthVal = total >= 20000 ? Math.round(total * 0.0211) : 0;
            taxDesc = incomeType === '9B' && total <= 5000
              ? 'ï¼ˆ9B ç¨¿è²»å°æ–¼ç­‰æ–¼ 5000 å…ƒä¸æ‰£ç¹³æ‰€å¾—ç¨…ï¼‰'
              : 'ï¼ˆä»£æ‰£ç¹³ 20%ï¼‰';
            healthDesc = total >= 20000 ? 'ï¼ˆé” 20000 å…ƒï¼Œä»£æ‰£ç¹³ 2.11%ï¼‰' : '';
          } else if (incomeType === '50') {
            taxVal = total >= 44250 ? Math.floor(total * 0.18) : Math.floor(total * 0.06);
            healthVal = total >= 29500 ? Math.round(total * 0.0211) : 0;
            taxDesc = total >= 44250 ? 'ï¼ˆé” 44,250 å…ƒï¼Œä»£æ‰£ç¹³ 18%ï¼‰' : 'ï¼ˆæœªé” 44,250 å…ƒï¼Œä»£æ‰£ç¹³ 6%ï¼‰';
            healthDesc = total >= 29500 ? 'ï¼ˆé” 29500 å…ƒï¼Œä»£æ‰£ç¹³ 2.11%ï¼‰' : '';
          }
        }

        if (unionInsured) {
          healthVal = 0;
          healthDesc = 'ï¼ˆå·²æŠ•ä¿å·¥æœƒï¼Œå…é™¤äºŒä»£å¥ä¿è£œå……ä¿è²»ï¼‰';
        }

        tax = taxVal.toLocaleString() + ' å…ƒ';
        health = healthVal.toLocaleString() + ' å…ƒ';
        net = (total - taxVal - healthVal).toLocaleString() + ' å…ƒ';
      }

      taxEl.textContent = tax;
      healthEl.textContent = health;
      netEl.textContent = net;
      taxDescEl.textContent = taxDesc;
      healthDescEl.textContent = healthDesc;
    }

    function previewImage(inputId, imgId) {
      const input = document.getElementById(inputId);
      const img = document.getElementById(imgId);
      input.addEventListener('change', (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        img.src = url;
        img.style.display = 'block';
      });
    }

    previewImage('id-front', 'id-front-preview');
    previewImage('id-back', 'id-back-preview');
    previewImage('signature-payee', 'signature-payee-preview');
    previewImage('signature-company', 'signature-company-preview');

    function importSample() {
      document.getElementById('company-name').value = 'é›²æ´¾å°æ•¸ä½å•†å‹™å·¥ä½œå®¤';
      document.getElementById('company-contact').value = 'cloudparty7676@gmail.com';
      document.getElementById('payee-name').value = 'ç‹å°æ˜';
      document.getElementById('contact').value = 'å°æ˜ä¿¡ç®±@example.com';
      document.getElementById('id-number').value = 'A123456789';
      document.getElementById('address').value = 'å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯101è™Ÿ';
      document.querySelector('input[name="nationality"][value="domestic"]').checked = true;
      document.getElementById('labor-content').value = `å”åŠ©é›²æ´¾å°æ•¸ä½å•†å‹™å·¥ä½œå®¤é€²è¡Œç¨‹å¼é–‹ç™¼å·¥ä½œï¼Œå•Ÿå‹•æ¬¾ 100,000 å…ƒã€‚æœŸé–“ ${new Date().getFullYear()} å¹´ ${new Date().getMonth() + 1} æœˆè‡³ ${new Date().getFullYear()} å¹´ ${new Date().getMonth() + 2} æœˆã€‚`;
      incomeTypeEl.value = '9A';
      updateBusinessType();
      businessTypeEl.value = '90';
      totalAmountEl.value = '100000';
      document.getElementById('payment-method').value = 'é€ééŠ€è¡Œè½‰å¸³/åŒ¯æ¬¾ï¼Œé ˜æ¬¾äººå¸³æˆ¶è³‡è¨Š\néŠ€è¡Œï¼š\nåˆ†è¡Œï¼š\næˆ¶åï¼š\nå¸³è™Ÿï¼š';
      unionInsuredEl.checked = false;
      calcFees();
    }

    function clearAll() {
      document.querySelectorAll('input[type="text"], input[type="number"], textarea').forEach((el) => { el.value = ''; });
      document.querySelector('input[name="nationality"][value="domestic"]').checked = true;
      incomeTypeEl.value = '';
      updateBusinessType();
      businessTypeEl.value = '';
      unionInsuredEl.checked = false;
      taxEl.textContent = 'N/A';
      healthEl.textContent = 'N/A';
      netEl.textContent = 'N/A';
      taxDescEl.textContent = '';
      healthDescEl.textContent = '';
      ['id-front-preview','id-back-preview','signature-payee-preview','signature-company-preview'].forEach((id) => {
        const img = document.getElementById(id);
        img.src = '';
        img.style.display = 'none';
      });
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const noPrint = document.querySelectorAll('.no-print');
      noPrint.forEach(el => el.style.display = 'none');
      document.body.classList.add('pdf-mode');
      const pdfClones = [];
      const sheet = document.getElementById('labor-reward-sheet');
      const textareas = sheet.querySelectorAll('textarea');
      textareas.forEach((ta) => {
        const clone = document.createElement('div');
        const cs = window.getComputedStyle(ta);
        clone.className = 'pdf-textarea-clone';
        clone.textContent = ta.value || '';
        clone.style.whiteSpace = 'pre-wrap';
        clone.style.wordBreak = 'break-word';
        clone.style.boxSizing = 'border-box';
        clone.style.width = ta.offsetWidth + 'px';
        clone.style.height = ta.offsetHeight + 'px';
        clone.style.padding = cs.padding;
        clone.style.border = cs.border;
        clone.style.borderRadius = cs.borderRadius;
        clone.style.font = cs.font;
        clone.style.lineHeight = cs.lineHeight;
        clone.style.color = cs.color;
        clone.style.background = cs.backgroundColor;
        clone.style.display = 'block';
        ta.style.display = 'none';
        ta.parentNode.insertBefore(clone, ta.nextSibling);
        pdfClones.push({ ta, clone });
      });
      try {
        const canvas = await html2canvas(sheet, {
          scale: 1,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff',
          width: sheet.offsetWidth,
          height: sheet.offsetHeight + 50,
          logging: false
        });

        const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4', compress: true });
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const margin = 10;
        const maxW = pageWidth - margin * 2;
        const maxH = pageHeight - margin * 2;

        const imgData = canvas.toDataURL('image/png', 1);
        let imgWidth = maxW;
        let imgHeight = (canvas.height * imgWidth) / canvas.width;
        if (imgHeight > maxH) {
          imgHeight = maxH;
          imgWidth = (canvas.width * imgHeight) / canvas.height;
        }
        const x = (pageWidth - imgWidth) / 2;
        const y = (pageHeight - imgHeight) / 2;

        pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight, undefined, 'FAST');

        const company = document.getElementById('company-name').value || '';
        const stamp = new Date().toISOString().slice(0, 19).replace(/[-:T]/g, '');
        const filename = `${company}å‹å‹™å ±é…¬å–®_${stamp}.pdf`;
        pdf.save(filename);
      } catch (err) {
        console.error('PDF ç”¢ç”Ÿå¤±æ•—', err);
        alert('PDF ç”¢ç”Ÿå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼');
      } finally {
        pdfClones.forEach(({ ta, clone }) => {
          ta.style.display = '';
          clone.remove();
        });
        noPrint.forEach(el => el.style.display = '');
        document.body.classList.remove('pdf-mode');
      }
    }

    document.getElementById('btn-sample').addEventListener('click', () => {
      if (confirm('æ‚¨ç¢ºå®šè¦åŒ¯å…¥ç¯„æœ¬è³‡æ–™å—ï¼Ÿç›®å‰çš„å‹å ±è³‡æ–™å°‡æœƒè¢«å–ä»£ã€‚')) {
        importSample();
      }
    });
    document.getElementById('btn-clear').addEventListener('click', () => {
      if (confirm('æ‚¨ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿ')) {
        clearAll();
      }
    });
    document.getElementById('btn-download').addEventListener('click', downloadPDF);
    
    incomeTypeEl.addEventListener('change', () => { updateBusinessType(); calcFees(); });
    incomeTypeEl.addEventListener('input', () => { updateBusinessType(); calcFees(); });
    businessTypeEl.addEventListener('change', calcFees);
    totalAmountEl.addEventListener('input', calcFees);
    totalAmountEl.addEventListener('change', calcFees);
    unionInsuredEl.addEventListener('change', calcFees);
    document.querySelectorAll('input[name="nationality"]').forEach(el => el.addEventListener('change', calcFees));

    updateBusinessType();
  </script>
</body>
</html>

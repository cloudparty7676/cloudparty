const i18n = {
  "zh-Hant": {
    meta: {
      title: "CloudParty｜雲派對",
      desc: "CloudParty｜雲端服務，提供 左右速速看 SmartLane 即時車流分析、NextVideo GIS 地理與監控雲端影像分析。"
    },
    nav: {
      homeAria: "雲派對 首頁",
      aria: "主要導覽",
      mobileAria: "手機導覽",
      langAria: "語言切換",
      menuAria: "開啟選單",
      menu: "選單 ☰",
      subtitle: "雲派對｜雲端服務",
      about: "公司介紹",
      solutions: "解決方案",
      workflow: "導入流程",
      contact: "聯絡我們"
    },
    hero: {
      title: "雲派對 ｜ 雲端服務",
      lead: {
        line1: "以雲端服務為核心，地理資訊整、資料整合與即時資料流，",
        line2: "讓你更快看見現場狀態、使用即時資訊進行數據分析。"
      },
      card0: {
        name: "左右速速看",
        title: "即時車流分析",
        desc: "即時推算道路車輛的速度/密度/壅塞，並提供車道建議。",
        list1: "車輛偵測與計數",
        list2: "壅塞趨勢與預測"
      },
      card1: {
        name: "NextVideo",
        title: "GIS × 監控影像",
        desc: "用地圖整合多路攝影機與事件分析，打造雲端影像監控中樞。",
        list1: "地圖定位與資產管理",
        list2: "事件偵測與告警",
        list3: "多租戶權限控管"
      }
    },
    about: {
      title: "公司介紹",
      desc: "雲派對是雲端服務公司，專注把「即時資料」變成可用的產品。",
      card1: {
        tag: "我們做什麼",
        title: "即時資料整合",
        desc: "把攝影機、感測器、第三方資料整合成單一資料管線，提供分析、告警、視覺化。"
      },
      card2: {
        tag: "我們擅長",
        title: "可落地方案",
        desc: "以可維運、可擴充的雲端架構。"
      },
      card3: {
        tag: "我們承諾",
        title: "穩定安全方案",
        desc: "確保上線後可穩定運作並持續迭代，並用視覺化顯示數據。"
      }
    },
    solutions: {
      title: "解決方案",
      smartlane: {
        tag: "左右速速看｜即時分析車流",
        head: "車流指標，一秒上手",
        body: "即時取得速度、密度、車流量與壅塞趨勢；支援視覺化。",
        point1: "車道層級的即時指標與建議",
        point2: "異常事件（事故/回堵）提示",
        point3: "歷史回放與趨勢報表",
        link: "左右速速看｜SmartLane"
      },
      nextvideo: {
        tag: "NextVideo｜GIS 與監控雲端影像",
        head: "用地圖管理影像，用事件管理風險",
        body: "攝影機、場域、資產與事件全部落在 GIS；打造雲端影像監控中樞。",
        point1: "地圖式監控牆（Map-first Console）",
        point2: "事件偵測/告警/工單串接",
        point3: "多場域、多權限、可擴充",
        link: "NextVideo｜GIS × 監控影像"
      }
    },
    workflow: {
      title: "導入流程",
      desc: "從需求到上線，維持輕量但可控：先快，再穩，再擴。",
      step1: { tag: "Step 1", title: "需求盤點", desc: "確認場域、資料來源、KPI、整合系統與權限角色。" },
      step2: { tag: "Step 2", title: "PoC / 小規模上線", desc: "選定 1–2 個代表性場域，驗證偵測效果、效能與流程。" },
      step3: { tag: "Step 3", title: "正式導入 / 擴充", desc: "完成監控、告警、報表、自動化與 API 串接，逐步擴到更多場域。" }
    },
    cta: {
      title: "想用即時資料加速決策？",
      desc: "留下需求，我們可以提供 Demo、PoC 規劃與導入建議。",
      note: "Line/Email",
      contact: "聯絡我們"
    },
    footer: {
      copyright: "CloudParty©. All rights reserved."
    }
  },
  en: {
    meta: {
      title: "CloudParty | Cloud Services",
      desc: "CloudParty | Cloud services providing SmartLane real-time traffic analytics and NextVideo GIS and cloud video monitoring intelligence."
    },
    nav: {
      homeAria: "CloudParty home",
      aria: "Primary navigation",
      mobileAria: "Mobile navigation",
      langAria: "Language switch",
      menuAria: "Open menu",
      menu: "Menu ☰",
      subtitle: "CloudParty | Cloud Services",
      about: "About",
      solutions: "Solutions",
      workflow: "Implementation",
      contact: "Contact"
    },
    hero: {
      title: "CloudParty | Cloud Services",
      lead: {
        line1: "CloudParty is cloud-first, combining GIS, data integration, and live data streams,",
        line2: "so teams see status faster and use real-time insights for analysis."
      },
      card0: {
        name: "SmartLane",
        title: "Real-time Traffic Analytics",
        desc: "Estimate speed, density, and congestion from road video with lane guidance.",
        list1: "Vehicle detection and counting",
        list2: "Congestion trends and prediction"
      },
      card1: {
        name: "NextVideo",
        title: "GIS × Video Monitoring",
        desc: "Combine cameras and events on GIS to build a cloud video command center.",
        list1: "Map positioning and asset management",
        list2: "Event detection and alerts",
        list3: "Multi-tenant access control"
      }
    },
    about: {
      title: "About",
      desc: "CloudParty is a cloud services company focused on turning real-time data into usable products.",
      card1: {
        tag: "What we do",
        title: "Real-time data integration",
        desc: "Integrate cameras, sensors, and third-party data into one pipeline for analytics, alerts, and visualization."
      },
      card2: {
        tag: "Our strength",
        title: "Deployable solutions",
        desc: "Built on maintainable, scalable cloud architecture."
      },
      card3: {
        tag: "Our promise",
        title: "Stable and secure delivery",
        desc: "Ensure stable operations and ongoing iteration with clear visualization of data."
      }
    },
    solutions: {
      title: "Solutions",
      smartlane: {
        tag: "SmartLane | Real-time traffic analytics",
        head: "Traffic KPIs in seconds",
        body: "Get real-time speed, density, volume, and congestion trends with visualization.",
        point1: "Lane-level metrics and guidance",
        point2: "Incident / congestion alerts",
        point3: "Replay and trend reports",
        link: "SmartLane | Real-time Traffic"
      },
      nextvideo: {
        tag: "NextVideo | GIS & cloud video",
        head: "Manage video on maps, manage risk by events",
        body: "Cameras, sites, assets, and events in GIS for a cloud control center.",
        point1: "Map-first monitoring wall",
        point2: "Event detection, alerts, and tickets",
        point3: "Multi-site, multi-role, extensible",
        link: "NextVideo | GIS Video Monitoring"
      }
    },
    workflow: {
      title: "Implementation",
      desc: "From requirements to launch: move fast, then stable, then scale.",
      step1: { tag: "Step 1", title: "Requirement review", desc: "Confirm sites, data sources, KPIs, integrations, and roles." },
      step2: { tag: "Step 2", title: "PoC / Pilot", desc: "Select 1–2 representative sites to validate performance and process." },
      step3: { tag: "Step 3", title: "Launch / Scale", desc: "Complete monitoring, alerts, reporting, automation, and API integration to expand." }
    },
    cta: {
      title: "Accelerate decisions with real-time data?",
      desc: "Share your needs and we can provide demos, PoC planning, and rollout advice.",
      note: "Line / Email",
      contact: "Contact us"
    },
    footer: {
      copyright: "CloudParty©. All rights reserved."
    }
  }
};

const setText = (el, value) => {
  if (el.dataset.i18nHtml) {
    el.innerHTML = value;
  } else {
    el.textContent = value;
  }
};

const resolveLang = () => {
  const stored = localStorage.getItem("lang");
  if (stored && i18n[stored]) return stored;
  const navLang = (navigator.language || "zh-Hant").toLowerCase();
  if (navLang.startsWith("zh")) return "zh-Hant";
  return "en";
};

const applyLanguage = (lang) => {
  const dict = i18n[lang] || i18n["zh-Hant"];

  document.documentElement.lang = lang === "en" ? "en" : "zh-Hant";
  if (dict.meta && dict.meta.title) document.title = dict.meta.title;
  const metaDesc = document.getElementById("meta-desc");
  if (metaDesc && dict.meta && dict.meta.desc) metaDesc.setAttribute("content", dict.meta.desc);

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.dataset.i18n;
    const value = key.split(".").reduce((acc, cur) => (acc ? acc[cur] : null), dict);
    if (value !== null && value !== undefined) setText(el, value);
  });

  document.querySelectorAll("[data-i18n-html]").forEach((el) => {
    const key = el.dataset.i18nHtml;
    const value = key.split(".").reduce((acc, cur) => (acc ? acc[cur] : null), dict);
    if (value !== null && value !== undefined) setText(el, value);
  });

  document.querySelectorAll("[data-i18n-attr]").forEach((el) => {
    const mapping = el.dataset.i18nAttr.split(",").map((pair) => pair.trim());
    mapping.forEach((pair) => {
      const parts = pair.split(":").map((v) => v.trim());
      const attr = parts[0];
      const key = parts[1];
      if (!attr || !key) return;
      const value = key.split(".").reduce((acc, cur) => (acc ? acc[cur] : null), dict);
      if (value !== null && value !== undefined) el.setAttribute(attr, value);
    });
  });

  document.querySelectorAll(".langBtn").forEach((btn) => {
    btn.classList.toggle("is-active", btn.dataset.lang === lang);
  });

  localStorage.setItem("lang", lang);
  document.dispatchEvent(new CustomEvent("language:change", { detail: { lang } }));
};

document.querySelectorAll(".langBtn").forEach((btn) => {
  btn.addEventListener("click", () => applyLanguage(btn.dataset.lang));
});

applyLanguage(resolveLang());
